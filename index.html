<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Rehab Session Pro | Advanced Neuro-Muscular Rehabilitation</title>
    <meta name="description" content="Next-generation rehabilitation platform with AI-driven protocols and real-time biofeedback">
    <meta name="theme-color" content="#0b1020">
    
    <!-- Preload critical resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    
    <style>
        /* =========================================================
           CRITICAL CSS (Above the fold)
        ========================================================= */
        :root {
            /* Color Palette - Enhanced contrast */
            --primary-50: #f0f9ff;
            --primary-100: #e0f2fe;
            --primary-200: #bae6fd;
            --primary-300: #7dd3fc;
            --primary-400: #38bdf8;
            --primary-500: #2dd4bf;
            --primary-600: #22c55e;
            --primary-700: #06b6d4;
            --primary-800: #2563eb;
            --primary-900: #111827;
            --primary-950: #0b1020;

            /* Enhanced accent colors */
            --accent-teal: #4df3c9;
            --accent-blue: #7cb7ff;
            --accent-purple: #b38bff;
            --accent-orange: #ffb36b;
            --accent-green: #8ef4c5;
            --accent-yellow: #ffe082;
            --accent-red: #ff6b81;
            --accent-pink: #ff8ad8;

            /* Neutral colors */
            --neutral-50: #f8fafc;
            --neutral-100: #f1f5f9;
            --neutral-200: #e2e8f0;
            --neutral-300: #cbd5e1;
            --neutral-400: #94a3b8;
            --neutral-500: #64748b;
            --neutral-600: #465672;
            --neutral-700: #2e3a55;
            --neutral-800: #1a2538;
            --neutral-900: #0f172a;
            --neutral-950: #070c16;

            /* Status colors */
            --status-success: #10b981;
            --status-warning: #f59e0b;
            --status-error: #ef4444;
            --status-info: #3b82f6;
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #4df3c9 0%, #6fb8ff 40%, #b38bff 100%);
            --gradient-secondary: linear-gradient(135deg, #8bfce0 0%, #7cb7ff 45%, #ff8ad8 100%);
            --gradient-success: linear-gradient(135deg, #7cf8c4 0%, #4df3c9 100%);
            --gradient-danger: linear-gradient(135deg, #ff6b81 0%, #ff9f66 100%);
            --gradient-dark: linear-gradient(135deg, #0b1224 0%, #0f172a 100%);
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', 'SF Mono', 'Roboto Mono', 'Courier New', monospace;
            
            /* Spacing */
            --space-unit: 0.25rem;
            --space-1: calc(1 * var(--space-unit));
            --space-2: calc(2 * var(--space-unit));
            --space-3: calc(3 * var(--space-unit));
            --space-4: calc(4 * var(--space-unit));
            --space-6: calc(6 * var(--space-unit));
            --space-8: calc(8 * var(--space-unit));
            --space-12: calc(12 * var(--space-unit));
            --space-16: calc(16 * var(--space-unit));
            
            /* Border Radius */
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-3xl: 2rem;
            --radius-full: 9999px;
            
            /* Shadows */
            --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.15), 0 1px 2px 0 rgba(0, 0, 0, 0.08);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.15), 0 2px 4px -1px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.25), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.35);
            --shadow-glow: 0 0 50px rgba(0, 212, 170, 0.4);
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Z-index */
            --z-below: -1;
            --z-base: 1;
            --z-above: 10;
            --z-docked: 100;
            --z-sticky: 200;
            --z-fixed: 300;
            --z-modal: 400;
            --z-toast: 600;
            --z-max: 9999;
        }

        /* =========================================================
           BASE RESETS
        ========================================================= */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-sans);
            background: radial-gradient(circle at 20% 20%, rgba(77, 243, 201, 0.08), transparent 30%), 
                        radial-gradient(circle at 80% 10%, rgba(115, 179, 255, 0.08), transparent 30%), 
                        var(--neutral-950);
            color: var(--neutral-50);
            line-height: 1.6;
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
        }

        /* =========================================================
           UTILITY CLASSES
        ========================================================= */
        .hidden { 
            display: none !important; 
        }
        
        .flex { display: flex; }
        .grid { display: grid; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: var(--space-2); }
        .gap-3 { gap: var(--space-3); }
        .gap-4 { gap: var(--space-4); }
        .gap-6 { gap: var(--space-6); }
        .gap-8 { gap: var(--space-8); }
        
        .p-3 { padding: var(--space-3); }
        .p-4 { padding: var(--space-4); }
        .p-6 { padding: var(--space-6); }
        .px-4 { padding-left: var(--space-4); padding-right: var(--space-4); }
        .py-3 { padding-top: var(--space-3); padding-bottom: var(--space-3); }
        .py-4 { padding-top: var(--space-4); padding-bottom: var(--space-4); }
        .py-6 { padding-top: var(--space-6); padding-bottom: var(--space-6); }
        
        .mt-2 { margin-top: var(--space-2); }
        .mt-3 { margin-top: var(--space-3); }
        .mt-4 { margin-top: var(--space-4); }
        .mt-6 { margin-top: var(--space-6); }
        .mb-3 { margin-bottom: var(--space-3); }
        .mb-4 { margin-bottom: var(--space-4); }
        .mb-6 { margin-bottom: var(--space-6); }
        
        .text-center { text-align: center; }
        .text-gradient {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            -webkit-text-fill-color: transparent;
        }
        
        .text-sm { font-size: 0.875rem; }
        .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-4xl { font-size: 2.25rem; }
        
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-extrabold { font-weight: 800; }
        
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        .rounded-2xl { border-radius: var(--radius-2xl); }
        .rounded-full { border-radius: var(--radius-full); }
        
        .w-full { width: 100%; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        
        /* =========================================================
           STATUS BAR
        ========================================================= */
        .status-bar {
            background: rgba(11, 16, 32, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75rem 0;
            position: sticky;
            top: 0;
            z-index: var(--z-fixed);
        }
        
        /* =========================================================
           PRIMARY NAVIGATION
        ========================================================= */
        .primary-nav {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.25rem 0;
            position: sticky;
            top: 3.5rem;
            z-index: var(--z-sticky);
        }
        
        .nav-links {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-3);
        }
        
        .nav-link {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
            padding: 0.75rem 1.25rem;
            color: var(--neutral-200);
            cursor: pointer;
            transition: all var(--transition-base);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: inherit;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--accent-teal);
        }
        
        /* =========================================================
           BUTTON SYSTEM
        ========================================================= */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            padding: var(--space-3) var(--space-6);
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 700;
            text-decoration: none;
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
            user-select: none;
            min-height: 44px;
            min-width: 44px;
            outline: none;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: var(--neutral-950);
            border: none;
            box-shadow: 0 10px 30px rgba(77, 243, 201, 0.35);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.16);
            color: var(--neutral-50);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.12);
            border-color: var(--accent-teal);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: var(--neutral-950);
            border: none;
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            border: none;
        }
        
        .btn-outline {
            background: transparent;
            border-color: rgba(255, 255, 255, 0.3);
            color: var(--neutral-100);
        }
        
        .btn-outline:hover:not(:disabled) {
            border-color: var(--accent-teal);
            color: var(--accent-teal);
        }
        
        .btn-lg {
            padding: var(--space-4) var(--space-8);
            font-size: 1.1rem;
            min-height: 52px;
        }
        
        .btn-xl {
            padding: var(--space-6) var(--space-12);
            font-size: 1.25rem;
            border-radius: var(--radius-2xl);
            min-height: 60px;
        }
        
        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: var(--radius-full);
        }
        
        /* =========================================================
           CARD COMPONENTS
        ========================================================= */
        .card {
            background: linear-gradient(160deg, rgba(15, 23, 42, 0.9), rgba(24, 36, 58, 0.88));
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: var(--radius-2xl);
            padding: clamp(1.25rem, 3vw, 2rem);
            transition: all var(--transition-base);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.35);
        }
        
        .card:hover {
            border-color: var(--accent-teal);
            transform: translateY(-4px);
            box-shadow: var(--shadow-glow);
        }
        
        /* =========================================================
           PANEL COMPONENTS
        ========================================================= */
        .panel {
            background: linear-gradient(180deg, rgba(12, 18, 35, 0.9), rgba(16, 26, 48, 0.92));
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: var(--radius-2xl);
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
        }
        
        .panel-header {
            padding: var(--space-6);
            background: radial-gradient(circle at 0% 0%, rgba(77, 243, 201, 0.12), transparent 40%), rgba(255, 255, 255, 0.02);
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        .panel-body {
            padding: var(--space-6);
        }
        
        .panel-footer {
            padding: var(--space-6);
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-top: 1px solid rgba(255, 255, 255, 0.12);
        }
        
        /* =========================================================
           SESSION BANNER
        ========================================================= */
        .session-banner {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.2), rgba(77, 243, 201, 0.18));
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border-radius: var(--radius-3xl);
            padding: clamp(1.5rem, 4vw, 2.5rem);
            margin-bottom: var(--space-8);
        }
        
        /* =========================================================
           STEP CARDS
        ========================================================= */
        .step-card {
            display: grid;
            grid-template-columns: auto 1fr auto;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4);
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-base);
            cursor: pointer;
            text-align: left;
            width: 100%;
            border: none;
            font-family: inherit;
        }
        
        .step-card:hover {
            border-color: var(--accent-teal);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glow);
        }
        
        /* =========================================================
           EXERCISE CARDS
        ========================================================= */
        .exercise-card {
            background: var(--neutral-900);
            border-left: 6px solid var(--accent-teal);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            transition: all var(--transition-base);
            margin-bottom: var(--space-4);
        }
        
        .exercise-card:hover {
            transform: translateX(8px);
            border-left-color: var(--accent-teal);
            box-shadow: var(--shadow-glow);
        }
        
        .exercise-card.completed {
            border-left-color: var(--accent-green);
            background: rgba(6, 214, 160, 0.08);
        }
        
        /* =========================================================
           PAIN MONITOR
        ========================================================= */
        .pain-monitor {
            background: rgba(26, 10, 10, 0.3);
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-2xl);
            padding: var(--space-6);
            margin: var(--space-8) 0;
        }
        
        .pain-scale {
            height: 48px;
            background: linear-gradient(90deg, 
                #10b981 0%, 
                #f59e0b 50%, 
                #ef4444 100%);
            border-radius: var(--radius-full);
            position: relative;
            margin: var(--space-6) 0;
            touch-action: none;
        }
        
        .pain-marker {
            position: absolute;
            top: -12px;
            width: 72px;
            height: 72px;
            background: white;
            border: 4px solid var(--neutral-950);
            border-radius: var(--radius-full);
            transform: translateX(-50%);
            cursor: grab;
            box-shadow: var(--shadow-2xl);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--neutral-950);
            transition: all var(--transition-base);
            user-select: none;
            z-index: var(--z-above);
            touch-action: none;
        }
        
        .pain-marker:active {
            cursor: grabbing;
            transform: translateX(-50%) scale(1.05);
        }
        
        .pain-threshold {
            position: absolute;
            top: -10px;
            bottom: -10px;
            width: 3px;
            background: white;
            transform: translateX(-50%);
            box-shadow: 0 0 15px white;
            z-index: var(--z-base);
        }
        
        /* =========================================================
           PROGRESS BAR
        ========================================================= */
        .progress-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: var(--radius-full);
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* =========================================================
           STATUS INDICATOR
        ========================================================= */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-3);
            background: rgba(0, 212, 170, 0.1);
            border: 1px solid rgba(0, 212, 170, 0.2);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-teal);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        
        /* =========================================================
           BADGE
        ========================================================= */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: var(--space-1) var(--space-3);
            background: rgba(0, 212, 170, 0.1);
            color: var(--accent-teal);
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: var(--radius-full);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* =========================================================
           FORM COMPONENTS
        ========================================================= */
        .form-group {
            margin-bottom: var(--space-6);
        }
        
        .form-label {
            display: block;
            margin-bottom: var(--space-2);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--neutral-200);
        }
        
        .form-control {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: rgba(255, 255, 255, 0.06);
            border: 2px solid rgba(255, 255, 255, 0.18);
            border-radius: var(--radius-lg);
            color: var(--neutral-50);
            font-family: inherit;
            font-size: 1rem;
            transition: all var(--transition-base);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-teal);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(77, 243, 201, 0.5);
        }
        
        .form-range {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-full);
            outline: none;
            -webkit-appearance: none;
        }
        
        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent-teal);
            border-radius: var(--radius-full);
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        /* =========================================================
           NOTIFICATION SYSTEM
        ========================================================= */
        .notification-container {
            position: fixed;
            top: 80px;
            right: var(--space-6);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            max-width: min(400px, calc(100vw - 2rem));
        }
        
        .notification {
            background: var(--neutral-900);
            border-left: 4px solid var(--accent-teal);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            box-shadow: var(--shadow-xl);
            animation: notification-slide-in 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 100%;
        }
        
        @keyframes notification-slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .notification.success { border-color: var(--status-success); }
        .notification.warning { border-color: var(--status-warning); }
        .notification.error { border-color: var(--status-error); }
        .notification.info { border-color: var(--status-info); }
        
        .notification-title {
            font-weight: 700;
            color: white;
            margin-bottom: var(--space-1);
        }
        
        .notification-message {
            color: var(--neutral-400);
            font-size: 0.875rem;
        }
        
        /* =========================================================
           ACTION DOCK
        ========================================================= */
        .action-dock {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: var(--z-fixed);
            width: 90%;
            max-width: 600px;
        }
        
        .action-dock-shell {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: var(--radius-2xl);
            padding: 1.5rem;
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 2rem;
            align-items: center;
            box-shadow: var(--shadow-xl);
        }
        
        /* =========================================================
           VISUAL EFFECTS
        ========================================================= */
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                to bottom,
                transparent 50%,
                rgba(0, 212, 170, 0.03) 50%
            );
            background-size: 100% 8px;
            pointer-events: none;
            z-index: var(--z-docked);
            animation: scan 10s linear infinite;
            opacity: 0.18;
        }
        
        @keyframes scan {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        
        .grid-overlay {
            position: fixed;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 120px 120px;
            opacity: 0.2;
            pointer-events: none;
            z-index: var(--z-below);
            mask-image: radial-gradient(circle at 50% 50%, black 60%, transparent 90%);
        }
        
        /* =========================================================
           CALM MODE
        ========================================================= */
        body.calm {
            background: #f8fafc !important;
            color: #0f172a !important;
        }
        
        body.calm .scanlines,
        body.calm .grid-overlay { 
            display: none !important;
        }
        
        body.calm .status-bar {
            background: rgba(255, 255, 255, 0.95) !important;
            border-bottom: 1px solid rgba(15, 23, 42, 0.15) !important;
        }
        
        body.calm .status-bar * { 
            color: #0f172a !important;
        }
        
        body.calm .panel,
        body.calm .card,
        body.calm .notification {
            background: #ffffff !important;
            color: #0f172a !important;
            border-color: rgba(15, 23, 42, 0.15) !important;
        }
        
        body.calm .text-gradient {
            background: linear-gradient(135deg, #2563eb 0%, #16a34a 100%) !important;
            -webkit-background-clip: text !important;
            background-clip: text !important;
        }
        
        body.calm .form-control {
            background: #ffffff !important;
            color: #0f172a !important;
            border-color: rgba(15, 23, 42, 0.2) !important;
        }
        
        body.calm .btn-secondary {
            background: #f1f5f9 !important;
            border-color: rgba(15, 23, 42, 0.2) !important;
            color: #0f172a !important;
        }
        
        body.calm .btn-outline {
            border-color: rgba(15, 23, 42, 0.25) !important;
            color: #0f172a !important;
        }
        
        body.calm .btn-outline:hover {
            border-color: #2563eb !important;
            color: #2563eb !important;
        }
        
        /* =========================================================
           CONTAINER
        ========================================================= */
        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 clamp(1rem, 3vw, 1.5rem);
        }
        
        .section {
            padding: clamp(2.75rem, 6vw, 4.5rem) 0;
        }
        
        /* =========================================================
           RESPONSIVE
        ========================================================= */
        @media (max-width: 1024px) {
            .nav-links {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 0 var(--space-4);
            }
            
            .section {
                padding: var(--space-12) 0;
            }
            
            .session-banner {
                display: none;
            }
            
            .nav-links {
                grid-template-columns: 1fr;
            }
            
            .action-dock {
                position: static;
                margin-top: var(--space-6);
            }
            
            .action-dock-shell {
                grid-template-columns: 1fr;
            }
        }
        
        /* =========================================================
           PRINT STYLES
        ========================================================= */
        @media print {
            .status-bar,
            .primary-nav,
            .action-dock,
            .notification-container,
            .scanlines,
            .grid-overlay,
            .btn {
                display: none !important;
            }
            
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to main content -->
    <a href="#main-content" class="skip-to-content" style="position: absolute; top: -40px; left: 0; background: var(--gradient-primary); color: var(--neutral-950); padding: var(--space-3) var(--space-4); border-radius: var(--radius-md); text-decoration: none; font-weight: 600; z-index: var(--z-max); transition: top 0.3s ease;">Skip to main content</a>
    
    <!-- Visual Effects -->
    <div class="scanlines" aria-hidden="true"></div>
    <div class="grid-overlay" aria-hidden="true"></div>
    
    <!-- Status Bar -->
    <div class="status-bar" role="status" aria-live="polite">
        <div class="container flex items-center justify-between">
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                    <div class="status-dot" id="systemStatus"></div>
                    <span class="text-sm font-semibold" id="statusText">Ready</span>
                </div>
                <time class="font-mono text-lg" id="currentTime">00:00:00</time>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right">
                    <div class="text-sm font-bold" id="missionName">Rehab Session</div>
                    <div class="text-xs" style="color: var(--neutral-400)" id="operatorName">Patient: Not set</div>
                </div>
                
                <div class="flex items-center gap-3" style="margin-left: 12px;">
                    <span class="text-xs" style="color: var(--neutral-400)" id="calmToggleLabel">Calm</span>
                    <button class="btn btn-icon btn-secondary" id="calmToggleBtn" aria-pressed="true" 
                            aria-label="Toggle calm mode" title="Toggle Calm Mode">
                        <i class="ri-moon-clear-line"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Guided Navigation -->
    <nav class="primary-nav" aria-label="Primary navigation">
        <div class="container">
            <div style="display: grid; grid-template-columns: auto 1fr auto; gap: var(--space-8); align-items: center;">
                <div>
                    <h1 style="font-size: 1.5rem; margin-bottom: 0.25rem;">Rehab Session Pro</h1>
                    <p style="font-size: 0.875rem; color: var(--neutral-400); margin: 0;">Guided steps with calmer visuals and quick access.</p>
                </div>
                <div class="nav-links" role="list">
                    <button class="nav-link" role="listitem" onclick="scrollToSection('phaseAuth')">
                        <i class="ri-id-card-line"></i> Sign in
                    </button>
                    <button class="nav-link" role="listitem" onclick="scrollToSection('phaseBio')">
                        <i class="ri-heart-pulse-line"></i> Readiness
                    </button>
                    <button class="nav-link" role="listitem" onclick="scrollToSection('phaseMission')">
                        <i class="ri-run-line"></i> Exercises
                    </button>
                    <button class="nav-link" role="listitem" onclick="scrollToSection('phaseDebrief')">
                        <i class="ri-clipboard-line"></i> Summary
                    </button>
                </div>
                <div style="display: flex; align-items: center; gap: var(--space-6);">
                    <span style="background: rgba(77, 243, 201, 0.1); color: var(--accent-teal); padding: 0.5rem 1rem; border-radius: var(--radius-full); font-size: 0.875rem; font-weight: 700; text-transform: uppercase;" id="navSessionState">Prep</span>
                    <div style="display: flex; gap: var(--space-3);">
                        <button class="btn btn-primary" id="navPrimaryAction" onclick="handlePrimaryNavAction()">
                            <i class="ri-play-line"></i> Start session
                        </button>
                        <button class="btn btn-outline" onclick="toggleCalmMode()">
                            <i class="ri-moon-clear-line"></i> Calm visuals
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Main Content -->
    <main id="main-content" style="padding-top: 5rem;">
        <div class="container">
            <!-- Hero Section -->
            <section class="section">
                <!-- Desktop View -->
                <div class="session-banner">
                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: var(--space-4); margin-bottom: var(--space-6);">
                        <div class="status-indicator" id="sessionStateChip">
                            <div class="status-dot"></div>
                            <span id="sessionStateText">Ready</span>
                        </div>
                        <div style="display: inline-flex; align-items: center; gap: var(--space-2); padding: 0.5rem 1rem; background: rgba(255, 255, 255, 0.08); border-radius: var(--radius-full); font-family: var(--font-mono); font-size: 1.125rem; font-weight: 600;">
                            <i class="ri-time-line"></i>
                            <time id="sessionClockValue">--:--:--</time>
                        </div>
                        <div style="display: inline-flex; align-items: center; gap: var(--space-2); padding: 0.5rem 1rem; background: rgba(179, 139, 255, 0.1); border: 1px solid rgba(179, 139, 255, 0.2); border-radius: var(--radius-full); font-size: 0.875rem; font-weight: 600; color: var(--accent-purple);">
                            <i class="ri-shield-star-line"></i>
                            Rehab Session · Pro
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1.2fr 1fr; align-items: center; gap: clamp(1.25rem, 3vw, 2rem); margin-bottom: var(--space-6);">
                        <div>
                            <p style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">Patient</p>
                            <h3 style="font-size: 1.875rem; font-weight: 800; margin: 0.25rem 0;" id="sessionPatient">Marvin</h3>
                            <p style="color: var(--neutral-300);" id="sessionPersonaCopy">Balance rehab · calm visuals on</p>
                        </div>
                        <div style="display: flex; gap: var(--space-4); flex-wrap: wrap;">
                            <button class="btn btn-primary btn-lg" id="heroPrimaryCta" onclick="handlePrimaryNavAction()">
                                <i class="ri-play-line"></i> Start session
                            </button>
                            <button class="btn btn-outline btn-lg" onclick="toggleCalmMode()">
                                <i class="ri-moon-clear-line"></i> Calm visuals
                            </button>
                            <button class="btn btn-secondary btn-lg" onclick="scrollToSection('phaseMission')">
                                <i class="ri-run-line"></i> Jump to exercises
                            </button>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--space-4);" role="list">
                        <button class="step-card" onclick="scrollToSection('phaseAuth')">
                            <div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); font-size: 1.25rem; color: var(--accent-teal);">
                                <i class="ri-id-card-line"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--neutral-50);">Sign in</div>
                                <div style="font-size: 0.875rem; color: var(--neutral-400);">Patient ID & clearance</div>
                            </div>
                            <span style="display: inline-flex; align-items: center; gap: var(--space-1); padding: 0.375rem 0.75rem; background: rgba(255, 255, 255, 0.1); color: var(--neutral-300); font-size: 0.75rem; font-weight: 600; border-radius: var(--radius-full); text-transform: uppercase;" id="stepAuthState">Prep</span>
                        </button>
                        <button class="step-card" onclick="scrollToSection('phaseBio')">
                            <div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); font-size: 1.25rem; color: var(--accent-teal);">
                                <i class="ri-heart-pulse-line"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--neutral-50);">Readiness</div>
                                <div style="font-size: 0.875rem; color: var(--neutral-400);">Pain, fatigue, stability</div>
                            </div>
                            <span style="display: inline-flex; align-items: center; gap: var(--space-1); padding: 0.375rem 0.75rem; background: rgba(255, 255, 255, 0.1); color: var(--neutral-300); font-size: 0.75rem; font-weight: 600; border-radius: var(--radius-full); text-transform: uppercase;" id="stepBioState">Locked</span>
                        </button>
                        <button class="step-card" onclick="scrollToSection('phaseMission')">
                            <div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); font-size: 1.25rem; color: var(--accent-teal);">
                                <i class="ri-run-line"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--neutral-50);">Exercises</div>
                                <div style="font-size: 0.875rem; color: var(--neutral-400);">Timer + voice control</div>
                            </div>
                            <span style="display: inline-flex; align-items: center; gap: var(--space-1); padding: 0.375rem 0.75rem; background: rgba(255, 255, 255, 0.1); color: var(--neutral-300); font-size: 0.75rem; font-weight: 600; border-radius: var(--radius-full); text-transform: uppercase;" id="stepMissionState">Queued</span>
                        </button>
                        <button class="step-card" onclick="scrollToSection('phaseDebrief')">
                            <div style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.1); border-radius: var(--radius-lg); font-size: 1.25rem; color: var(--accent-teal);">
                                <i class="ri-clipboard-line"></i>
                            </div>
                            <div>
                                <div style="font-weight: 600; color: var(--neutral-50);">Summary</div>
                                <div style="font-size: 0.875rem; color: var(--neutral-400);">Notes & export</div>
                            </div>
                            <span style="display: inline-flex; align-items: center; gap: var(--space-1); padding: 0.375rem 0.75rem; background: rgba(255, 255, 255, 0.1); color: var(--neutral-300); font-size: 0.75rem; font-weight: 600; border-radius: var(--radius-full); text-transform: uppercase;" id="stepDebriefState">Later</span>
                        </button>
                    </div>
                </div>

                <!-- Hero Panel -->
                <div class="card mt-8">
                    <span class="badge">Patient-first layout</span>
                    <h1 class="text-gradient mt-4" style="font-size: clamp(2rem, 5vw, 3rem); font-weight: 800; line-height: 1.2;">Calmer rehab. Clearer next steps.</h1>
                    <p class="mt-4" style="color: var(--neutral-300);">Stay focused on what matters: safe movement, measurable progress, and fast access to the right phase.</p>
                    
                    <div style="display: flex; gap: var(--space-4); flex-wrap: wrap; margin-top: var(--space-6);">
                        <button class="btn btn-primary btn-xl" onclick="handlePrimaryNavAction()">
                            <i class="ri-flag-line"></i> Start today's plan
                        </button>
                        <button class="btn btn-secondary btn-lg" onclick="toggleCalmMode()">
                            <i class="ri-moon-clear-line"></i> Toggle Calm / Pro
                        </button>
                        <button class="btn btn-outline btn-lg" onclick="scrollToSection('phaseBio')">
                            <i class="ri-focus-line"></i> Jump to readiness
                        </button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-4); margin-top: var(--space-6);">
                        <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-xl); padding: var(--space-4);">
                            <div style="font-size: 0.875rem; color: var(--neutral-400); text-transform: uppercase;">Profile</div>
                            <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent-teal);" id="summaryProfile">—</div>
                            <div style="font-size: 0.875rem; color: var(--neutral-400);" id="summarySupport">Injury focus · Intensity</div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-xl); padding: var(--space-4);">
                            <div style="font-size: 0.875rem; color: var(--neutral-400); text-transform: uppercase;">Streak</div>
                            <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent-teal);" id="summaryStreak">0 days</div>
                            <div style="font-size: 0.875rem; color: var(--neutral-400);">Total sessions <span id="summarySessions">0</span></div>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: var(--radius-xl); padding: var(--space-4);">
                            <div style="font-size: 0.875rem; color: var(--neutral-400); text-transform: uppercase;">Pain ceiling</div>
                            <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent-teal);" id="summaryPainLimit">7 / 10</div>
                            <div style="font-size: 0.875rem; color: var(--neutral-400);">Current baseline <span id="summaryPainBaseline">0 / 10</span></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Phase 1: Authentication -->
            <section id="phaseAuth" class="section">
                <div class="panel">
                    <div class="panel-header">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-4xl font-extrabold text-gradient">Rehab Session Pro</h1>
                                <p class="mt-2" style="color: var(--neutral-400);">AI-powered rehabilitation with voice control & telehealth</p>
                            </div>
                            <div class="status-indicator">
                                <div class="status-dot"></div>
                                <span>Start here</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-body">
                        <form id="authForm" style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
                            <!-- Operator Info -->
                            <div>
                                <div class="form-group">
                                    <label for="operatorId" class="form-label">Your name</label>
                                    <input type="text" class="form-control" id="operatorId" 
                                           placeholder="Enter your name" value="MARVIN" required>
                                    <div class="text-sm mt-1" style="color: var(--neutral-400);">Enter your full name or patient ID</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="securityCode" class="form-label">SECURITY CLEARANCE</label>
                                    <input type="password" class="form-control" id="securityCode" 
                                           placeholder="Optional" value="Rehab_RISING">
                                    <div class="text-sm mt-1" style="color: var(--neutral-400);">Optional security code for additional protection</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="missionProfile" class="form-label">SESSION PROFILE</label>
                                    <select class="form-control" id="missionProfile" required>
                                        <option value="HARDCORE">HARDCORE: NO RETREAT</option>
                                        <option value="AGGRESSIVE">AGGRESSIVE: MAXIMUM FORCE</option>
                                        <option value="STANDARD" selected>STANDARD: STEADY PROGRESS</option>
                                        <option value="RECOVERY">RECOVERY: TACTICAL REHAB</option>
                                        <option value="AI_ADAPTIVE">AI ADAPTIVE: SMART PROGRESS</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Bio Metrics -->
                            <div>
                                <div class="form-group">
                                    <label for="baselinePain" class="form-label">BASELINE PAIN INDEX (0-10)</label>
                                    <input type="range" class="form-range" id="baselinePain" min="0" max="10" value="0">
                                    <div class="flex justify-between mt-3">
                                        <span class="text-sm" style="color: var(--neutral-400);">NO PAIN</span>
                                        <output class="text-sm font-bold" id="painValue" for="baselinePain">0</output>
                                        <span class="text-sm" style="color: var(--neutral-400);">MAXIMUM</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">FATIGUE LEVEL</label>
                                    <div class="progress-bar">
                                        <div class="progress-bar-fill" id="fatigueBar" style="width: 0%"></div>
                                    </div>
                                    <div class="flex justify-between mt-3">
                                        <span class="text-sm" style="color: var(--neutral-400);">RESTED</span>
                                        <output class="text-sm font-bold" id="fatigueValue">0%</output>
                                        <span class="text-sm" style="color: var(--neutral-400);">EXHAUSTED</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">READINESS ASSESSMENT</label>
                                    <div style="display: flex; flex-direction: column; align-items: center; margin-top: 1.5rem;">
                                        <div style="position: relative; width: 140px; height: 140px; margin: 0 auto;">
                                            <svg width="140" height="140" style="transform: rotate(-90deg);">
                                                <circle cx="70" cy="70" r="60" fill="none" stroke="rgba(255, 255, 255, 0.1)" stroke-width="8"></circle>
                                                <circle cx="70" cy="70" r="60" fill="none" stroke="var(--accent-teal)" stroke-width="8" id="readinessRing" 
                                                        stroke-dasharray="377" stroke-dashoffset="377"></circle>
                                            </svg>
                                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.875rem; font-weight: 800; color: var(--neutral-50);" id="readinessScore">100%</div>
                                        </div>
                                        <p class="text-sm mt-4" style="color: var(--neutral-400);">System calibrated and ready for protocol initiation</p>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    
                    <div class="panel-footer">
                        <div class="flex items-center justify-between">
                            <button class="btn btn-secondary" type="button">
                                <i class="ri-fingerprint-line"></i> BIOMETRIC LOGIN
                            </button>
                            <div class="flex gap-4">
                                <button class="btn btn-danger" type="button" onclick="emergencyStop()">
                                    <i class="ri-error-warning-line"></i> END
                                </button>
                                <button class="btn btn-primary btn-lg" type="submit" form="authForm">
                                    <i class="ri-fire-line"></i> INITIATE PLAN
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Phase 2: Bio-Readiness -->
            <section id="phaseBio" class="section hidden">
                <div class="panel">
                    <div class="panel-header">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-extrabold text-gradient">Readiness check</h2>
                                <p class="mt-2" style="color: var(--neutral-400);">A quick check-in before you begin</p>
                            </div>
                            <div class="status-indicator">
                                <div class="status-dot"></div>
                                <span>CALIBRATING</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-body">
                        <!-- Real-time Metrics -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-4); margin-bottom: 3rem;">
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400); margin-bottom: 0.5rem;">PAIN INDEX</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="realTimePain">0.0</div>
                            </div>
                            
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400); margin-bottom: 0.5rem;">HEART RATE ZONE</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="heartRate">--</div>
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">BPM</div>
                            </div>
                            
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400); margin-bottom: 0.5rem;">STABILITY SCORE</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="stabilityScore">100%</div>
                            </div>
                            
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400); margin-bottom: 0.5rem;">READINESS</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="bioReadiness">100%</div>
                                <div class="progress-bar mt-4">
                                    <div class="progress-bar-fill" id="readinessBar" style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pain Monitor -->
                        <div class="pain-monitor">
                            <h3 class="text-xl font-bold mb-6">Pain check</h3>
                            <div class="pain-scale" id="painScale">
                                <div class="pain-marker" id="painMarker" style="left: 0%;">0</div>
                                <div class="pain-threshold" id="painThreshold" style="left: 70%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.875rem; font-weight: 600; color: var(--neutral-400); margin-top: var(--space-2);">
                                <span>GREEN ZONE</span>
                                <span>YELLOW ZONE</span>
                                <span>RED ZONE</span>
                            </div>
                            
                            <div id="painWarning" class="hidden" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: var(--radius-lg); padding: var(--space-4); margin-top: var(--space-4);">
                                <div class="flex items-center gap-4">
                                    <div class="status-dot" style="background: var(--accent-red); animation: blink 1s infinite;"></div>
                                    <div>
                                        <h4 class="font-bold">Pain above your limit</h4>
                                        <p class="text-sm mt-1" style="color: var(--neutral-400);">Reduce intensity or pause protocol. Consult if pain persists.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <div class="flex justify-between">
                            <button class="btn btn-secondary" onclick="scrollToSection('phaseAuth')">
                                <i class="ri-arrow-left-line"></i> BACK
                            </button>
                            <button class="btn btn-success btn-lg" onclick="beginMission()">
                                <i class="ri-rocket-line"></i> Begin session
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Phase 3: Active Mission -->
            <section id="phaseMission" class="section hidden">
                <div class="panel">
                    <div class="panel-header">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-extrabold text-gradient">Active session</h2>
                                <p class="mt-2" style="color: var(--neutral-400);" id="missionSubtitle">Week 1 — Learning & Safety</p>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="status-indicator">
                                    <div class="status-dot" style="background: var(--accent-green);"></div>
                                    <span id="missionStatus">In progress</span>
                                </div>
                                <time class="font-mono text-2xl font-bold" id="missionTimer">15:00</time>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-body">
                        <!-- Exercise Dock -->
                        <div style="position: sticky; top: 84px; z-index: var(--z-above); background: var(--neutral-900); border: 1px solid rgba(255, 255, 255, 0.18); border-radius: var(--radius-xl); padding: 1.25rem; display: flex; align-items: flex-start; justify-content: space-between; gap: 1.5rem; box-shadow: var(--shadow-md); margin-bottom: 1.5rem;">
                            <div>
                                <p style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">Quick exercise access</p>
                                <h3 style="font-size: 1.25rem; font-weight: 700;" id="dockExerciseName">Single-Leg Stand</h3>
                                <p style="color: var(--neutral-400);" id="dockExerciseMeta">00:10 · 4 sets · basic</p>
                                <div style="display: flex; gap: var(--space-3); margin-top: var(--space-3);">
                                    <span style="display: inline-flex; align-items: center; gap: var(--space-1); padding: 0.375rem 0.75rem; background: rgba(255, 255, 255, 0.1); color: var(--neutral-300); font-size: 0.75rem; font-weight: 600; border-radius: var(--radius-full); text-transform: uppercase;" id="dockExerciseCount">0/0 done</span>
                                    <span class="badge" id="dockExercisePhase">Week 1 — Learning &amp; Safety</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: var(--space-3);">
                                <button class="btn btn-primary" onclick="quickStartExercise()">
                                    <i class="ri-play-line"></i> Start / Resume
                                </button>
                                <button class="btn btn-secondary">
                                    <i class="ri-run-line"></i> Exercise list
                                </button>
                            </div>
                        </div>

                        <!-- Exercise Container -->
                        <div id="exerciseContainer" class="mb-8">
                            <!-- Exercises loaded dynamically -->
                        </div>
                        
                        <!-- Live Metrics -->
                        <div class="card">
                            <div class="flex items-center justify-between mb-6">
                                <h3 class="text-xl font-bold">LIVE METRICS</h3>
                                <span class="badge">
                                    <i class="ri-pulse-line"></i> Real-time
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-4);">
                                <div style="text-align: center; padding: var(--space-4); background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-xl);">
                                    <div class="text-2xl font-bold font-mono" id="livePain">0.0</div>
                                    <div class="text-xs uppercase mt-1" style="color: var(--neutral-400);">CURRENT PAIN</div>
                                </div>
                                <div style="text-align: center; padding: var(--space-4); background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-xl);">
                                    <div class="text-2xl font-bold font-mono" id="completedExercises">0</div>
                                    <div class="text-xs uppercase mt-1" style="color: var(--neutral-400);">EXERCISES DONE</div>
                                </div>
                                <div style="text-align: center; padding: var(--space-4); background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-xl);">
                                    <div class="text-2xl font-bold font-mono" id="timeElapsed">00:00</div>
                                    <div class="text-xs uppercase mt-1" style="color: var(--neutral-400);">TIME ELAPSED</div>
                                </div>
                                <div style="text-align: center; padding: var(--space-4); background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-xl);">
                                    <div class="text-2xl font-bold font-mono" id="successRate">100%</div>
                                    <div class="text-xs uppercase mt-1" style="color: var(--neutral-400);">SUCCESS RATE</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <div class="flex justify-center gap-4">
                            <button class="btn btn-danger" onclick="emergencyStop()">
                                <i class="ri-alarm-line"></i> Pause for safety
                            </button>
                            <button class="btn btn-secondary" onclick="pauseMission()" id="pauseBtn">
                                <i class="ri-pause-line"></i> PAUSE
                            </button>
                            <button class="btn btn-success" onclick="completeMission()">
                                <i class="ri-check-double-line"></i> COMPLETE
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Phase 4: Debrief -->
            <section id="phaseDebrief" class="section hidden">
                <div class="panel">
                    <div class="panel-header">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 class="text-3xl font-extrabold text-gradient">Session summary</h2>
                                <p class="mt-2" style="color: var(--neutral-400);">Notes and session record</p>
                            </div>
                            <div class="status-indicator">
                                <div class="status-dot" style="background: var(--accent-green);"></div>
                                <span>SESSION SUCCESS</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-body">
                        <!-- Performance Summary -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-4); margin-bottom: 3rem;">
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">TOTAL TIME</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="debriefTime">00:00</div>
                            </div>
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">EXERCISES COMPLETED</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="debriefExercises">0</div>
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">/ 12 TOTAL</div>
                            </div>
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">AVG PAIN INDEX</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="debriefPain">0.0</div>
                            </div>
                            <div class="card">
                                <div style="font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400);">SUCCESS RATE</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--neutral-50); font-family: var(--font-mono);" id="debriefSuccess">100%</div>
                            </div>
                        </div>
                        
                        <!-- Session Notes -->
                        <div class="form-group mb-8">
                            <label for="postMissionNotes" class="form-label">Notes (optional)</label>
                            <textarea class="form-control" id="postMissionNotes" rows="4" 
                                      placeholder="Record observations, challenges, victories..."></textarea>
                        </div>
                    </div>
                    
                    <div class="panel-footer">
                        <div class="flex justify-center gap-4">
                            <button class="btn btn-secondary">
                                <i class="ri-save-line"></i> Save
                            </button>
                            <button class="btn btn-primary">
                                <i class="ri-download-line"></i> Export
                            </button>
                            <button class="btn btn-success" onclick="window.location.reload()">
                                <i class="ri-refresh-line"></i> New session
                            </button>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Action Dock -->
            <div class="action-dock">
                <div class="action-dock-shell">
                    <div>
                        <h3 style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--neutral-400); margin-bottom: 0.25rem;">Live status</h3>
                        <div style="font-size: 1.5rem; font-weight: 800; color: var(--neutral-50); margin-bottom: 0.25rem;" id="dockStatusLabel">Prep</div>
                        <p style="font-size: 0.875rem; color: var(--neutral-400);" id="dockStatusHint">Authenticate to unlock your plan.</p>
                    </div>
                    <div style="display: flex; gap: var(--space-3);">
                        <button class="btn btn-primary" id="dockPrimaryAction" onclick="handlePrimaryNavAction()">
                            <i class="ri-play-line"></i> Start session
                        </button>
                        <button class="btn btn-secondary" onclick="scrollToSection('phaseMission')">
                            <i class="ri-run-line"></i> Jump to exercises
                        </button>
                        <button class="btn btn-danger" onclick="emergencyStop()">
                            <i class="ri-alarm-line"></i> Emergency stop
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
    // =========================================================
    // APPLICATION STATE
    // =========================================================
    const AppState = {
        version: '4.3',
        operator: {
            id: 'MARVIN',
            clearance: 'Rehab_RISING',
            profile: {
                intensity: 'STANDARD',
                painThreshold: 7
            }
        },
        session: {
            active: false,
            phase: 1,
            startTime: null,
            elapsedTime: 0,
            totalTime: 15 * 60,
            paused: false,
            authenticated: false,
            completedExercises: [],
            currentExercise: null,
            notes: '',
            metrics: {
                painIndex: 0,
                fatigue: 0,
                readiness: 100
            }
        },
        progress: {
            totalSessions: 0,
            streak: 0
        }
    };

    // =========================================================
    // STATE MANAGEMENT
    // =========================================================
    const StateManager = {
        KEY: 'RehabSessionPro_State',
        
        save() {
            try {
                localStorage.setItem(this.KEY, JSON.stringify(AppState));
                return true;
            } catch (error) {
                console.error('Failed to save state:', error);
                return false;
            }
        },
        
        load() {
            try {
                const saved = localStorage.getItem(this.KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    Object.assign(AppState, parsed);
                    return true;
                }
            } catch (error) {
                console.error('Failed to load state:', error);
            }
            return false;
        }
    };

    // =========================================================
    // NOTIFICATION SYSTEM
    // =========================================================
    function showNotification(title, message, type = 'info', duration = 5000) {
        const container = document.getElementById('notificationContainer');
        if (!container) return;
        
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        notification.innerHTML = `
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
        `;
        
        container.appendChild(notification);
        
        // Auto-remove after duration
        if (duration > 0) {
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, duration);
        }
    }

    // =========================================================
    // TIME FUNCTIONS
    // =========================================================
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateSystemTime() {
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', { 
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
        });
        
        // Update all clock elements
        const clocks = ['currentTime', 'sessionClockValue'];
        
        clocks.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = timeString;
                if (el.tagName === 'TIME') {
                    el.setAttribute('datetime', now.toISOString());
                }
            }
        });
    }

    // =========================================================
    // STATUS UPDATES
    // =========================================================
    function updateSystemStatus() {
        const statusDot = document.getElementById('systemStatus');
        const statusText = document.getElementById('statusText');
        
        if (!statusDot || !statusText) return;
        
        let status = 'Ready';
        let color = 'var(--accent-teal)';
        
        if (AppState.session.active) {
            status = AppState.session.paused ? 'Paused' : 'Active';
            color = AppState.session.paused ? 'var(--accent-yellow)' : 'var(--accent-green)';
        } else if (AppState.session.authenticated) {
            status = 'Ready';
            color = 'var(--accent-teal)';
        }
        
        statusDot.style.background = color;
        statusText.textContent = status;
        statusText.style.color = color;
    }

    // =========================================================
    // PAIN MONITOR
    // =========================================================
    class PainMonitor {
        constructor() {
            this.marker = document.getElementById('painMarker');
            this.scale = document.getElementById('painScale');
            this.currentValue = 0;
            this.isDragging = false;
            
            if (this.marker && this.scale) {
                this.init();
            }
        }
        
        init() {
            // Mouse events
            this.marker.addEventListener('mousedown', this.startDrag.bind(this));
            document.addEventListener('mousemove', this.drag.bind(this));
            document.addEventListener('mouseup', this.stopDrag.bind(this));
            
            // Touch events
            this.marker.addEventListener('touchstart', this.startDrag.bind(this));
            document.addEventListener('touchmove', this.drag.bind(this));
            document.addEventListener('touchend', this.stopDrag.bind(this));
            
            // Set initial value
            this.setValue(0);
        }
        
        startDrag(e) {
            e.preventDefault();
            this.isDragging = true;
            this.marker.style.cursor = 'grabbing';
        }
        
        drag(e) {
            if (!this.isDragging) return;
            
            e.preventDefault();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            if (!clientX) return;
            
            const rect = this.scale.getBoundingClientRect();
            let x = clientX - rect.left;
            x = Math.max(0, Math.min(x, rect.width));
            
            const percentage = (x / rect.width) * 100;
            this.setValue(percentage / 10);
        }
        
        stopDrag() {
            this.isDragging = false;
            this.marker.style.cursor = 'grab';
        }
        
        setValue(value) {
            this.currentValue = Math.max(0, Math.min(10, value));
            const percentage = this.currentValue * 10;
            
            // Update UI
            this.marker.style.left = `${percentage}%`;
            this.marker.textContent = this.currentValue.toFixed(1);
            
            // Update app state and displays
            AppState.session.metrics.painIndex = this.currentValue;
            
            // Update all pain displays
            const painDisplays = [
                'painValue',
                'realTimePain',
                'livePain',
                'summaryPainBaseline'
            ];
            
            painDisplays.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    if (id === 'summaryPainBaseline') {
                        el.textContent = `${this.currentValue.toFixed(1)}/10`;
                    } else {
                        el.textContent = this.currentValue.toFixed(1);
                    }
                }
            });
            
            // Update fatigue based on pain
            const fatigue = Math.min(100, this.currentValue * 15);
            AppState.session.metrics.fatigue = fatigue;
            
            const fatigueBar = document.getElementById('fatigueBar');
            const fatigueValue = document.getElementById('fatigueValue');
            
            if (fatigueBar) fatigueBar.style.width = `${fatigue}%`;
            if (fatigueValue) fatigueValue.textContent = `${fatigue}%`;
            
            // Update readiness
            const readiness = Math.max(0, 100 - (this.currentValue * 10) - (fatigue * 0.5));
            AppState.session.metrics.readiness = readiness;
            
            document.getElementById('readinessScore').textContent = `${Math.round(readiness)}%`;
            document.getElementById('bioReadiness').textContent = `${Math.round(readiness)}%`;
            
            // Update readiness ring
            const readinessRing = document.getElementById('readinessRing');
            if (readinessRing) {
                const circumference = 2 * Math.PI * 60;
                const offset = circumference - (readiness / 100) * circumference;
                readinessRing.style.strokeDashoffset = offset;
            }
            
            // Update readiness bar
            const readinessBar = document.getElementById('readinessBar');
            if (readinessBar) {
                readinessBar.style.width = `${readiness}%`;
            }
            
            // Check pain threshold
            this.checkThreshold();
            
            // Save state
            StateManager.save();
        }
        
        checkThreshold() {
            const threshold = AppState.operator.profile.painThreshold;
            const warning = document.getElementById('painWarning');
            
            if (this.currentValue >= threshold) {
                if (warning) warning.classList.remove('hidden');
                if (this.currentValue >= 8) {
                    showNotification('Severe Pain Alert', 
                        `Pain level ${this.currentValue.toFixed(1)}/10 detected. Consider stopping.`, 
                        'error');
                }
            } else {
                if (warning) warning.classList.add('hidden');
            }
        }
    }

    // =========================================================
    // CALM MODE
    // =========================================================
    class CalmModeManager {
        constructor() {
            this.KEY = "RehabCalmMode";
            this.init();
        }
        
        init() {
            this.loadPreference();
            this.setupToggleButton();
        }
        
        loadPreference() {
            try {
                const saved = localStorage.getItem(this.KEY);
                if (saved !== null) {
                    this.apply(saved === "1");
                }
            } catch (e) {
                console.error('Failed to load calm mode preference:', e);
            }
        }
        
        apply(enabled) {
            document.body.classList.toggle("calm", enabled);
            
            // Update button
            const btn = document.getElementById("calmToggleBtn");
            const label = document.getElementById("calmToggleLabel");
            
            if (btn) {
                btn.setAttribute("aria-pressed", enabled.toString());
                btn.innerHTML = enabled ? 
                    '<i class="ri-moon-clear-line"></i>' : 
                    '<i class="ri-sun-line"></i>';
            }
            
            if (label) {
                label.textContent = enabled ? "Calm" : "Pro";
            }
            
            // Save preference
            try {
                localStorage.setItem(this.KEY, enabled ? "1" : "0");
            } catch (e) {
                console.error('Failed to save calm mode preference:', e);
            }
        }
        
        toggle() {
            const isCalm = document.body.classList.contains("calm");
            this.apply(!isCalm);
        }
        
        setupToggleButton() {
            const btn = document.getElementById("calmToggleBtn");
            if (btn) {
                btn.addEventListener('click', () => this.toggle());
            }
        }
    }

    // =========================================================
    // AUTHENTICATION
    // =========================================================
    function authenticateOperator() {
        const operatorId = document.getElementById('operatorId').value.trim();
        const missionProfile = document.getElementById('missionProfile').value;
        
        if (!operatorId) {
            showNotification('Authentication Failed', 'Please enter your name', 'error');
            return;
        }
        
        // Update app state
        AppState.operator.id = operatorId.toUpperCase();
        AppState.operator.profile.intensity = missionProfile;
        AppState.session.authenticated = true;
        
        // Update UI
        document.getElementById('operatorName').textContent = `Patient: ${operatorId}`;
        document.getElementById('missionName').textContent = `Rehab Session - ${missionProfile}`;
        document.getElementById('sessionPatient').textContent = operatorId;
        
        // Update phase states
        document.getElementById('stepAuthState').textContent = 'Done';
        document.getElementById('stepBioState').textContent = 'Ready';
        
        // Show next phase
        document.getElementById('phaseAuth').classList.add('hidden');
        document.getElementById('phaseBio').classList.remove('hidden');
        
        // Update status and save
        updateSystemStatus();
        refreshExperienceSummary();
        StateManager.save();
        
        showNotification('Authentication Successful', 
            `Welcome back, ${operatorId}. Ready for readiness check.`, 
            'success');
        
        // Scroll to bio phase
        setTimeout(() => {
            document.getElementById('phaseBio').scrollIntoView({ behavior: 'smooth' });
        }, 100);
    }

    // =========================================================
    // MISSION FUNCTIONS
    // =========================================================
    function beginMission() {
        if (!AppState.session.authenticated) {
            showNotification('Not Authenticated', 'Please complete authentication first', 'warning');
            scrollToSection('phaseAuth');
            return;
        }
        
        // Hide bio phase, show mission phase
        document.getElementById('phaseBio').classList.add('hidden');
        document.getElementById('phaseMission').classList.remove('hidden');
        
        // Update app state
        AppState.session.active = true;
        AppState.session.paused = false;
        AppState.session.phase = 3;
        AppState.session.startTime = Date.now();
        
        // Start timer
        startSessionTimer();
        
        // Update UI
        updateSystemStatus();
        refreshExperienceSummary();
        loadExercises();
        
        // Show notification
        showNotification('Session Started', 'Week 1 exercises loaded. Begin when ready.', 'success');
        
        // Save state
        StateManager.save();
        
        // Scroll to mission section
        setTimeout(() => {
            document.getElementById('phaseMission').scrollIntoView({ behavior: 'smooth' });
        }, 100);
    }

    function pauseMission() {
        if (!AppState.session.active) return;
        
        AppState.session.paused = !AppState.session.paused;
        
        if (AppState.session.paused) {
            showNotification('Session Paused', 'Session paused. Resume when ready.', 'warning');
        } else {
            showNotification('Session Resumed', 'Session resumed. Continue your exercises.', 'success');
        }
        
        updateSystemStatus();
        refreshExperienceSummary();
        StateManager.save();
    }

    function emergencyStop() {
        if (!AppState.session.active) return;
        
        AppState.session.active = false;
        AppState.session.paused = false;
        
        // Show emergency notification
        showNotification('EMERGENCY STOP', 'Session terminated for safety. Check pain levels.', 'error', 10000);
        
        // Update UI
        updateSystemStatus();
        refreshExperienceSummary();
        
        // Save state
        StateManager.save();
        
        // Scroll to auth section for restart
        setTimeout(() => {
            scrollToSection('phaseAuth');
        }, 2000);
    }

    function completeMission() {
        if (!AppState.session.active) return;
        
        // Calculate session metrics
        const duration = Math.floor((Date.now() - AppState.session.startTime) / 1000);
        
        // Update progress
        AppState.progress.totalSessions++;
        AppState.progress.streak++;
        
        // End session
        AppState.session.active = false;
        AppState.session.paused = false;
        AppState.session.phase = 4;
        
        // Update UI
        document.getElementById('phaseMission').classList.add('hidden');
        document.getElementById('phaseDebrief').classList.remove('hidden');
        
        // Set debrief values
        document.getElementById('debriefTime').textContent = formatTime(duration);
        document.getElementById('debriefExercises').textContent = AppState.session.completedExercises.length;
        document.getElementById('debriefPain').textContent = AppState.session.metrics.painIndex.toFixed(1);
        document.getElementById('debriefSuccess').textContent = `${Math.min(100, Math.floor((AppState.session.completedExercises.length / 7) * 100))}%`;
        
        // Show success notification
        showNotification('Session Complete', `Great work! ${AppState.session.completedExercises.length} exercises completed.`, 'success');
        
        // Update status and save
        updateSystemStatus();
        refreshExperienceSummary();
        StateManager.save();
        
        // Scroll to debrief
        setTimeout(() => {
            document.getElementById('phaseDebrief').scrollIntoView({ behavior: 'smooth' });
        }, 100);
    }

    // =========================================================
    // EXERCISE FUNCTIONS
    // =========================================================
    function loadExercises() {
        const exerciseContainer = document.getElementById('exerciseContainer');
        
        if (!exerciseContainer) return;
        
        // Week 1 exercises
        const exercises = [
            {
                id: 'single-leg-stand',
                name: 'Single-Leg Stand',
                description: 'Stand on one leg, other foot lightly off the floor',
                duration: 10,
                sets: 4,
                reps: '2× each leg',
                difficulty: 'basic'
            },
            {
                id: 'tandem-stand',
                name: 'Feet in a Line (Tandem)',
                description: 'Heel-to-toe stand',
                duration: 10,
                sets: 2,
                reps: 'Switch lead foot',
                difficulty: 'basic'
            },
            {
                id: 'side-stepping',
                name: 'Side Stepping',
                description: 'Side steps with balance',
                duration: 30,
                sets: 2,
                reps: '5 steps each direction',
                difficulty: 'basic'
            },
            {
                id: 'backward-walking',
                name: 'Backward Walking',
                description: 'Slow backward steps',
                duration: 20,
                sets: 2,
                reps: '5 steps',
                difficulty: 'basic'
            },
            {
                id: 'calf-raises',
                name: 'Calf Raises',
                description: 'Rise onto toes holding counter',
                duration: 30,
                sets: 1,
                reps: '10 each leg',
                difficulty: 'basic'
            },
            {
                id: 'marching-knees',
                name: 'Marching Knees',
                description: 'Lift one knee at a time',
                duration: 30,
                sets: 1,
                reps: '10 total steps',
                difficulty: 'basic'
            },
            {
                id: 'mini-squats',
                name: 'Mini Squats',
                description: 'Small knee bends',
                duration: 30,
                sets: 1,
                reps: '8-10 times',
                difficulty: 'basic'
            }
        ];
        
        // Clear container
        exerciseContainer.innerHTML = '';
        
        // Load exercise list
        exercises.forEach((exercise) => {
            const isCompleted = AppState.session.completedExercises.includes(exercise.id);
            
            const exerciseCard = document.createElement('div');
            exerciseCard.className = `exercise-card ${isCompleted ? 'completed' : ''}`;
            exerciseCard.id = `exercise-${exercise.id}`;
            
            exerciseCard.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <div style="font-size: 1.25rem; font-weight: 700; color: var(--neutral-50);">${exercise.name}</div>
                    <span style="background: rgba(255, 255, 255, 0.1); color: var(--neutral-300); padding: 0.25rem 0.75rem; border-radius: var(--radius-full); font-size: 0.75rem; font-weight: 600; text-transform: uppercase;">${exercise.difficulty}</span>
                </div>
                <div style="display: flex; gap: 1rem; margin-bottom: 0.75rem;">
                    <span style="display: inline-flex; align-items: center; gap: 0.375rem; font-size: 0.875rem; color: var(--neutral-400);">
                        <i class="ri-time-line"></i> ${exercise.duration}s
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 0.375rem; font-size: 0.875rem; color: var(--neutral-400);">
                        <i class="ri-repeat-line"></i> ${exercise.sets} sets
                    </span>
                    <span style="display: inline-flex; align-items: center; gap: 0.375rem; font-size: 0.875rem; color: var(--neutral-400);">
                        <i class="ri-run-line"></i> ${exercise.reps}
                    </span>
                </div>
                <p style="color: var(--neutral-300); margin-bottom: 1rem;">${exercise.description}</p>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-top: 1rem;">
                    <div style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-lg);">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-50); font-family: var(--font-mono);">${exercise.duration}</div>
                        <div style="font-size: 0.75rem; color: var(--neutral-400); text-transform: uppercase;">Seconds</div>
                    </div>
                    <div style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-lg);">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-50); font-family: var(--font-mono);">${exercise.sets}</div>
                        <div style="font-size: 0.75rem; color: var(--neutral-400); text-transform: uppercase;">Sets</div>
                    </div>
                    <div style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.05); border-radius: var(--radius-lg);">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--neutral-50); font-family: var(--font-mono);">${isCompleted ? '✓' : '○'}</div>
                        <div style="font-size: 0.75rem; color: var(--neutral-400); text-transform: uppercase;">Status</div>
                    </div>
                </div>
                <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                    <button class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="startExercise('${exercise.id}')">
                        <i class="ri-play-line"></i> Start
                    </button>
                    <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="completeExercise('${exercise.id}')">
                        <i class="ri-check-line"></i> Mark Done
                    </button>
                    <button class="btn btn-outline" style="padding: 0.5rem 1rem; font-size: 0.875rem;" onclick="skipExercise('${exercise.id}')">
                        <i class="ri-skip-forward-line"></i> Skip
                    </button>
                </div>
            `;
            
            exerciseContainer.appendChild(exerciseCard);
        });
        
        // Update quick exercise display
        if (exercises.length > 0) {
            const firstExercise = exercises[0];
            const isFirstCompleted = AppState.session.completedExercises.includes(firstExercise.id);
            
            if (!isFirstCompleted) {
                document.getElementById('dockExerciseName').textContent = firstExercise.name;
                document.getElementById('dockExerciseMeta').textContent = `${firstExercise.duration}s · ${firstExercise.sets} sets · ${firstExercise.difficulty}`;
            }
        }
        
        // Update exercise count
        updateExerciseCount();
    }

    function startExercise(exerciseId) {
        const exerciseName = document.querySelector(`#exercise-${exerciseId} div:first-child`).textContent;
        
        // Update UI
        document.getElementById('dockExerciseName').textContent = exerciseName;
        
        // Show notification
        showNotification('Exercise Started', `Starting ${exerciseName}. Focus on form and breathing.`, 'info');
        
        // Set as current exercise
        AppState.session.currentExercise = exerciseId;
        StateManager.save();
    }

    function completeExercise(exerciseId) {
        const exerciseCard = document.getElementById(`exercise-${exerciseId}`);
        if (!exerciseCard) return;
        
        // Mark as completed
        exerciseCard.classList.add('completed');
        
        // Update completed exercises
        if (!AppState.session.completedExercises.includes(exerciseId)) {
            AppState.session.completedExercises.push(exerciseId);
        }
        
        // Update UI
        updateExerciseCount();
        
        // Show notification
        showNotification('Exercise Complete', 'Great work! Move to next exercise when ready.', 'success');
        
        // Save state
        StateManager.save();
        
        // Check if all exercises are done
        if (AppState.session.completedExercises.length >= 7) {
            setTimeout(() => {
                showNotification('All Exercises Complete', 'All Week 1 exercises completed! Ready for session summary.', 'success');
            }, 1000);
        }
    }

    function skipExercise(exerciseId) {
        showNotification('Exercise Skipped', 'Exercise skipped. Move to next when ready.', 'warning');
        
        // Mark as completed but skipped
        if (!AppState.session.completedExercises.includes(exerciseId)) {
            AppState.session.completedExercises.push(exerciseId);
            updateExerciseCount();
        }
        
        StateManager.save();
    }

    function updateExerciseCount() {
        const completedCount = AppState.session.completedExercises.length;
        
        document.getElementById('completedExercises').textContent = completedCount;
        document.getElementById('dockExerciseCount').textContent = `${completedCount}/7 done`;
    }

    function quickStartExercise() {
        // Find first uncompleted exercise
        const firstExercise = document.querySelector('.exercise-card:not(.completed)');
        if (firstExercise) {
            const exerciseId = firstExercise.id.replace('exercise-', '');
            startExercise(exerciseId);
        } else {
            showNotification('All Exercises Complete', 'All exercises are already completed!', 'info');
        }
    }

    function startSessionTimer() {
        const timerElement = document.getElementById('missionTimer');
        const timeElapsedElement = document.getElementById('timeElapsed');
        
        if (!timerElement || !timeElapsedElement) return;
        
        const updateTimer = () => {
            if (!AppState.session.active || AppState.session.paused) return;
            
            const now = Date.now();
            const elapsed = Math.floor((now - AppState.session.startTime) / 1000);
            const remaining = Math.max(0, AppState.session.totalTime - elapsed);
            
            AppState.session.elapsedTime = elapsed;
            
            // Update timer displays
            timerElement.textContent = formatTime(remaining);
            timeElapsedElement.textContent = formatTime(elapsed);
            
            // Update success rate
            const successRate = Math.max(70, 100 - Math.floor(elapsed / 60));
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            // Auto-complete after time is up
            if (remaining <= 0) {
                completeMission();
                return;
            }
            
            // Schedule next update
            setTimeout(updateTimer, 1000);
        };
        
        updateTimer();
    }

    // =========================================================
    // HELPER FUNCTIONS
    // =========================================================
    function scrollToSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section) {
            section.scrollIntoView({ behavior: 'smooth' });
        }
    }

    function handlePrimaryNavAction() {
        if (!AppState.session.authenticated) {
            scrollToSection('phaseAuth');
            showNotification('Authentication Required', 'Please sign in first', 'info');
        } else if (!AppState.session.active) {
            beginMission();
        } else if (AppState.session.paused) {
            pauseMission();
        } else {
            scrollToSection('phaseMission');
        }
    }

    function refreshExperienceSummary() {
        // Update all summary displays
        document.getElementById('summaryProfile').textContent = AppState.operator.profile.intensity;
        document.getElementById('summaryStreak').textContent = `${AppState.progress.streak} days`;
        document.getElementById('summarySessions').textContent = AppState.progress.totalSessions;
        document.getElementById('summaryPainLimit').textContent = `${AppState.operator.profile.painThreshold}/10`;
        document.getElementById('summaryPainBaseline').textContent = `${AppState.session.metrics.painIndex.toFixed(1)}/10`;
        
        // Update session state
        const sessionState = AppState.session.active ? 
            (AppState.session.paused ? 'Paused' : 'Active') : 
            (AppState.session.authenticated ? 'Ready' : 'Prep');
        
        const stateElements = [
            'navSessionState',
            'sessionStateText',
            'dockStatusLabel'
        ];
        
        stateElements.forEach(id => {
            const el = document.getElementById(id);
            if (el) el.textContent = sessionState;
        });
        
        // Update action button text
        const primaryActionBtn = document.getElementById('navPrimaryAction');
        const dockActionBtn = document.getElementById('dockPrimaryAction');
        const heroActionBtn = document.getElementById('heroPrimaryCta');
        
        let actionText = 'Start session';
        let actionIcon = 'ri-play-line';
        
        if (AppState.session.active) {
            if (AppState.session.paused) {
                actionText = 'Resume session';
                actionIcon = 'ri-play-line';
            } else {
                actionText = 'Pause session';
                actionIcon = 'ri-pause-line';
            }
        } else if (AppState.session.authenticated) {
            actionText = 'Begin session';
            actionIcon = 'ri-rocket-line';
        }
        
        [primaryActionBtn, dockActionBtn, heroActionBtn].forEach(btn => {
            if (btn) {
                btn.innerHTML = `<i class="${actionIcon}"></i> ${actionText}`;
            }
        });
    }

    // =========================================================
    // INITIALIZATION
    // =========================================================
    document.addEventListener('DOMContentLoaded', () => {
        // Initialize managers
        new CalmModeManager();
        new PainMonitor();
        
        // Load saved state
        if (StateManager.load()) {
            showNotification('System Ready', 'Previous session loaded successfully', 'success', 3000);
        }
        
        // Update initial displays
        updateSystemTime();
        updateSystemStatus();
        refreshExperienceSummary();
        
        // Setup authentication form
        const authForm = document.getElementById('authForm');
        if (authForm) {
            authForm.addEventListener('submit', function(e) {
                e.preventDefault();
                authenticateOperator();
            });
        }
        
        // Setup baseline pain slider
        const baselinePain = document.getElementById('baselinePain');
        if (baselinePain) {
            baselinePain.addEventListener('input', function() {
                const value = parseInt(this.value);
                document.getElementById('painValue').textContent = value;
                
                // Update pain monitor
                const painMonitor = new PainMonitor();
                painMonitor.setValue(value);
            });
            
            // Set initial value
            baselinePain.dispatchEvent(new Event('input'));
        }
        
        // Setup keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Space to pause/resume
            if (e.code === 'Space' && AppState.session.active) {
                e.preventDefault();
                pauseMission();
            }
            
            // Escape for emergency stop
            if (e.code === 'Escape' && AppState.session.active) {
                emergencyStop();
            }
        });
        
        // Initialize clock
        setInterval(updateSystemTime, 1000);
        
        console.log('🚀 Rehab Session Pro v4.3 - Fully Functional');
    });

    // =========================================================
    // GLOBAL FUNCTIONS
    // =========================================================
    window.authenticateOperator = authenticateOperator;
    window.beginMission = beginMission;
    window.pauseMission = pauseMission;
    window.emergencyStop = emergencyStop;
    window.completeMission = completeMission;
    window.showNotification = showNotification;
    window.scrollToSection = scrollToSection;
    window.handlePrimaryNavAction = handlePrimaryNavAction;
    window.quickStartExercise = quickStartExercise;
    window.startExercise = startExercise;
    window.completeExercise = completeExercise;
    window.skipExercise = skipExercise;
    window.toggleCalmMode = () => {
        const calmModeManager = new CalmModeManager();
        calmModeManager.toggle();
    };
    </script>
</body>
</html>
